\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{moeptikz}[2015/07/18 moepTikZ]

\RequirePackage{tumcolor}
\RequirePackage{tikz}
\RequirePackage{makeshape}

\usetikzlibrary{patterns}

\makeatletter
%FIXME define default colors for messages


\ifcsname{}tikzextractx\endcsname%
\else%
\newcommand*{\tikzextractx}[2]{%
	\tikz@scan@one@point\pgfutil@firstofone#1\relax
		\edef#2{\the\pgf@x}%
}%
\newcommand*{\tikzextracty}[2]{%
	\tikz@scan@one@point\pgfutil@firstofone#1\relax
		\edef#2{\the\pgf@y}%
}%
\fi%

%\DeclareDocumentCommand{\moeptikzlabel}{o r() O{above} m}{%
%	\draw[#1] (#2) -- ++(1,1) -- node[#3] {#4} ++(4,0);
%}


%==============================================================================
% server
%==============================================================================
\def\serveranchor{
	\pgf@xa=\pgfshapeminwidth
	\pgf@ya=\pgfshapeminwidth
	\pgf@xa=.5\pgf@xa
	\pgf@ya=.5\pgf@ya
	
	\pgfpathmoveto{\pgfpoint{.75\pgf@xa}{.4\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-.75\pgf@xa}{.4\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-.97\pgf@xa}{-.18\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-.99\pgf@xa}{-.18\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-.99\pgf@xa}{-.4\pgf@ya}}
	\pgfpathlineto{\pgfpoint{.99\pgf@xa}{-.4\pgf@ya}}
	\pgfpathlineto{\pgfpoint{.99\pgf@xa}{-.18\pgf@ya}}
	\pgfpathlineto{\pgfpoint{.97\pgf@xa}{-.18\pgf@ya}}
	\pgfpathclose
}
\def\serverborder{
	\def\server@strokecolor{\tikz@strokecolor}
	\def\server@fillcolor{\tikz@fillcolor}
	\ifx\tikz@strokecolor\pgfutil@empty
		\def\server@strokecolor{black}
	\fi
	\ifx\tikz@fillcolor\pgfutil@empty
		\def\server@fillcolor{black}
	\fi

	\pgfmathparse{.004*\pgfshapeminwidth}\let\linewidth\pgfmathresult
	\pgfmathparse{.008*\pgfshapeminwidth}\let\linewidthlarge\pgfmathresult
	\pgfmathparse{.005*\pgfshapeminwidth}\let\cornerarc\pgfmathresult
	\pgfmathparse{.04*sqrt(\pgfshapeminwidth)}\let\fontwidth\pgfmathresult

	% Front
	\pgfdeclarehorizontalshading{xserveFront}{100bp}{
		color(0bp)=(\server@fillcolor!40);
		color(50bp)=(\server@fillcolor!20);
		color(100bp)=(\server@fillcolor!40)}
	\pgfsetstrokecolor{black!40}
	\pgfsetfillcolor{black!40}
	\pgfpathrectanglecorners{\northeast \pgf@y=-.2\pgf@y}{\northeast \pgf@x=-\pgf@x \pgf@y=-.4\pgf@y}
	\pgfshadepath{xserveFront}{0}
	\pgfusepath{}

	\pgfdeclarehorizontalshading{xserveFrontAbove}{100bp}{
		color(0bp)=(\server@fillcolor!40);
		color(50bp)=(\server@fillcolor!10);
		color(100bp)=(\server@fillcolor!40)}
	\pgfsetstrokecolor{black!40}
	\pgfmoveto{\northeast \pgf@y=-.2\pgf@y}
	\pgflineto{\northeast \pgf@x=-\pgf@x \pgf@y=-.2\pgf@y}
	\pgflineto{\northeast \pgf@x=-.99\pgf@x \pgf@y=-.18\pgf@y}
	\pgflineto{\northeast \pgf@x=.99\pgf@x \pgf@y=-.18\pgf@y}
	\pgfclosepath
	\pgfshadepath{xserveFrontAbove}{0}
	\pgfusepath{}

	% Deckel 
	\pgfdeclareradialshading{xserveCover}{\pgfpoint{0pt}{5\pgf@ya}}{%
		rgb(0bp)=(1,1,1);
		color(70bp)=(\server@fillcolor!80);
		rgb(105bp)=(1,1,1)}
	\pgfmoveto{\northeast \pgf@x=.75\pgf@x \pgf@y=.4\pgf@y}
	\pgflineto{\northeast \pgf@x=.97\pgf@x \pgf@y=-.18\pgf@y}
	\pgflineto{\northeast \pgf@x=-.97\pgf@x \pgf@y=-.18\pgf@y}
	\pgflineto{\northeast \pgf@x=-.75\pgf@x \pgf@y=.4\pgf@y}
	\pgfclosepath
	\pgfshadepath{xserveCover}{0}
	\pgfusepath{}

	% Amaturen
	\pgfsetstrokecolor{black}
	\pgfsetlinewidth{1.5*\linewidth}
	\pgfsetcornersarced{\pgfpoint{\cornerarc}{\cornerarc}}
	\pgfmoveto{\northeast \pgf@x=-.9\pgf@x \pgf@y=-.4\pgf@y}
	\pgflineto{\northeast \pgf@x=-.9\pgf@x \pgf@y=-.28\pgf@y}
	\pgflineto{\northeast \pgf@x=.9\pgf@x \pgf@y=-.28\pgf@y}
	\pgflineto{\northeast \pgf@x=.9\pgf@x \pgf@y=-.4\pgf@y}
	\pgfusepath{stroke}
	
	\pgfmoveto{\northeast \pgf@x=-.895\pgf@x \pgf@y=-.4\pgf@y}
	\pgflineto{\northeast \pgf@x=-.895\pgf@x \pgf@y=-.28\pgf@y}
	\pgfusepath{stroke}
	
	\pgfmoveto{\northeast \pgf@x=.895\pgf@x \pgf@y=-.4\pgf@y}
	\pgflineto{\northeast \pgf@x=.895\pgf@x \pgf@y=-.28\pgf@y}
	\pgfusepath{stroke}
	
	\pgfsetlinewidth{2*\linewidth}
	\pgfmoveto{\northeast \pgf@x=-.44\pgf@x \pgf@y=-.4\pgf@y}
	\pgflineto{\northeast \pgf@x=-.44\pgf@x \pgf@y=-.28\pgf@y}
	\pgfusepath{stroke}
	\pgfmoveto{\northeast \pgf@x=-.225\pgf@x \pgf@y=-.4\pgf@y}
	\pgflineto{\northeast \pgf@x=-.225\pgf@x \pgf@y=-.28\pgf@y}
	\pgfusepath{stroke}
	\pgfmoveto{\northeast \pgf@x=.225\pgf@x \pgf@y=-.4\pgf@y}
	\pgflineto{\northeast \pgf@x=.225\pgf@x \pgf@y=-.28\pgf@y}
	\pgfusepath{stroke}
	\pgfmoveto{\northeast \pgf@x=.44\pgf@x \pgf@y=-.4\pgf@y}
	\pgflineto{\northeast \pgf@x=.44\pgf@x \pgf@y=-.28\pgf@y}
	\pgfusepath{stroke}

	% optical drive
	\pgfsetfillcolor{black}
	\pgfpathrectanglecorners{\northeast \pgf@x=.9\pgf@x \pgf@y=-.22\pgf@y}{\northeast \pgf@x=.34\pgf@x \pgf@y=-.24\pgf@y}
	\pgfusepath{fill}

	% schlitze front oben
	\pgfpathrectanglecorners{\northeast \pgf@x=.3\pgf@x \pgf@y=-.21\pgf@y}{\northeast \pgf@x=.285\pgf@x \pgf@y=-.26\pgf@y}
	\pgfusepath{fill}
	\pgfpathrectanglecorners{\northeast \pgf@x=.26\pgf@x \pgf@y=-.21\pgf@y}{\northeast \pgf@x=.245\pgf@x \pgf@y=-.26\pgf@y}
	\pgfusepath{fill}
	\pgfpathrectanglecorners{\northeast \pgf@x=.22\pgf@x \pgf@y=-.21\pgf@y}{\northeast \pgf@x=.205\pgf@x \pgf@y=-.26\pgf@y}
	\pgfusepath{fill}
	\pgfpathrectanglecorners{\northeast \pgf@x=.18\pgf@x \pgf@y=-.21\pgf@y}{\northeast \pgf@x=.165\pgf@x \pgf@y=-.26\pgf@y}
	\pgfusepath{fill}
	\pgfpathrectanglecorners{\northeast \pgf@x=.14\pgf@x \pgf@y=-.21\pgf@y}{\northeast \pgf@x=.125\pgf@x \pgf@y=-.26\pgf@y}
	\pgfusepath{fill}
	\pgfpathrectanglecorners{\northeast \pgf@x=.10\pgf@x \pgf@y=-.21\pgf@y}{\northeast \pgf@x=.085\pgf@x \pgf@y=-.26\pgf@y}
	\pgfusepath{fill}
	\pgfpathrectanglecorners{\northeast \pgf@x=.06\pgf@x \pgf@y=-.21\pgf@y}{\northeast \pgf@x=.045\pgf@x \pgf@y=-.26\pgf@y}
	\pgfusepath{fill}

	\pgfpathrectanglecorners{\northeast \pgf@x=-.3\pgf@x \pgf@y=-.21\pgf@y}{\northeast \pgf@x=-.285\pgf@x \pgf@y=-.26\pgf@y}
	\pgfusepath{fill}
	\pgfpathrectanglecorners{\northeast \pgf@x=-.26\pgf@x \pgf@y=-.21\pgf@y}{\northeast \pgf@x=-.245\pgf@x \pgf@y=-.26\pgf@y}
	\pgfusepath{fill}
	\pgfpathrectanglecorners{\northeast \pgf@x=-.22\pgf@x \pgf@y=-.21\pgf@y}{\northeast \pgf@x=-.205\pgf@x \pgf@y=-.26\pgf@y}
	\pgfusepath{fill}
	\pgfpathrectanglecorners{\northeast \pgf@x=-.18\pgf@x \pgf@y=-.21\pgf@y}{\northeast \pgf@x=-.165\pgf@x \pgf@y=-.26\pgf@y}
	\pgfusepath{fill}
	\pgfpathrectanglecorners{\northeast \pgf@x=-.14\pgf@x \pgf@y=-.21\pgf@y}{\northeast \pgf@x=-.125\pgf@x \pgf@y=-.26\pgf@y}
	\pgfusepath{fill}
	\pgfpathrectanglecorners{\northeast \pgf@x=-.10\pgf@x \pgf@y=-.21\pgf@y}{\northeast \pgf@x=-.085\pgf@x \pgf@y=-.26\pgf@y}
	\pgfusepath{fill}
	\pgfpathrectanglecorners{\northeast \pgf@x=-.06\pgf@x \pgf@y=-.21\pgf@y}{\northeast \pgf@x=-.045\pgf@x \pgf@y=-.26\pgf@y}
	\pgfusepath{fill}

	% Lichter
	\pgfsetfillcolor{cyan}
	\pgfpathcircle{\northeast \pgf@x=-.35\pgf@x \pgf@y=-.22\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfpathcircle{\northeast \pgf@x=-.375\pgf@x \pgf@y=-.22\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfpathcircle{\northeast \pgf@x=-.4\pgf@x \pgf@y=-.22\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfpathcircle{\northeast \pgf@x=-.425\pgf@x \pgf@y=-.22\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfpathcircle{\northeast \pgf@x=-.45\pgf@x \pgf@y=-.22\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfsetfillcolor{black}
	\pgfpathcircle{\northeast \pgf@x=-.475\pgf@x \pgf@y=-.22\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfpathcircle{\northeast \pgf@x=-.5\pgf@x \pgf@y=-.22\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfpathcircle{\northeast \pgf@x=-.525\pgf@x \pgf@y=-.22\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfpathcircle{\northeast \pgf@x=-.55\pgf@x \pgf@y=-.22\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}

	\pgfsetfillcolor{cyan}
	\pgfpathcircle{\northeast \pgf@x=-.35\pgf@x \pgf@y=-.24\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfpathcircle{\northeast \pgf@x=-.375\pgf@x \pgf@y=-.24\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfpathcircle{\northeast \pgf@x=-.4\pgf@x \pgf@y=-.24\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfpathcircle{\northeast \pgf@x=-.425\pgf@x \pgf@y=-.24\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfsetfillcolor{black}
	\pgfpathcircle{\northeast \pgf@x=-.45\pgf@x \pgf@y=-.24\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfpathcircle{\northeast \pgf@x=-.475\pgf@x \pgf@y=-.24\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfpathcircle{\northeast \pgf@x=-.5\pgf@x \pgf@y=-.24\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfpathcircle{\northeast \pgf@x=-.525\pgf@x \pgf@y=-.24\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfpathcircle{\northeast \pgf@x=-.55\pgf@x \pgf@y=-.24\pgf@y}{.5\pgflinewidth}
	\pgfusepath{fill}
	\pgfdeclareverticalshading{xserveEject}{100bp}{color(0bp)=(black); color(100bp)=(black!70)}
	\pgfsetcornersarced{\pgfpoint{0pt}{0pt}}
	\pgfsetfillcolor{black}
	\pgfpathrectanglecorners{\northeast \pgf@x=-.425\pgf@x \pgf@y=-.3925\pgf@y}{\northeast \pgf@x=-.24\pgf@x \pgf@y=-.2925\pgf@y}
	\pgfshadepath{xserveEject}{180}
	\pgfusepath{}
	
	\pgfsetcornersarced{\pgfpoint{0pt}{0pt}}
	\pgfsetfillcolor{black}
	\pgfpathrectanglecorners{\northeast \pgf@x=.425\pgf@x \pgf@y=-.3925\pgf@y}{\northeast \pgf@x=.24\pgf@x \pgf@y=-.2925\pgf@y}
	\pgfshadepath{xserveEject}{180}
	\pgfusepath{}
}
\pgfdeclareshape{server}{
	\setpaths{\serveranchor}{\serverborder}
	\savedanchor\northeast{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=.5\pgf@x
		\pgf@y=.5\pgf@y
	}
	\savedanchor\southwest{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=-.5\pgf@x
		\pgf@y=-.5\pgf@y
	}
	\anchor{north}{\northeast \pgf@y=.4\pgf@y \pgf@x=0pt}
	\anchor{north east}{\northeast \pgf@x=.75\pgf@x \pgf@y=.4\pgf@y}
	\anchor{north west}{\northeast \pgf@x=-.75\pgf@x \pgf@y=.4\pgf@y}
	\anchor{east}{\northeast \pgf@x=.9\pgf@x \pgf@y=0pt}
	\anchor{south}{\northeast \pgf@x=0pt \pgf@y=-.4\pgf@y}
	\anchor{south east}{\northeast \pgf@y=-.4\pgf@y}
	\anchor{south west}{\northeast \pgf@x=-\pgf@x \pgf@y=-.4\pgf@y}
	\anchor{west}{\northeast \pgf@x=-.9\pgf@x \pgf@y=0pt}
	\anchor{text}{
		\pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
		\pgfmathsetlength\pgf@y{\pgfshapeminwidth}%
		\pgf@x=0pt
		\pgf@y=-.5\pgf@y
		\advance\pgf@x by -.5\wd\pgfnodeparttextbox
		\advance\pgf@y by -\ht\pgfnodeparttextbox
	}
}


%==============================================================================
% client
%==============================================================================
\def\clientanchor{
	\pgf@xa=\pgfshapeminwidth
	\pgf@ya=\pgfshapeminwidth
	\pgf@xa=.5\pgf@xa
	\pgf@ya=.5\pgf@ya
	
	\pgfpathmoveto{\pgfpoint{\pgf@xa}{.79\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-\pgf@xa}{.79\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-\pgf@xa}{-.5\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-.25\pgf@xa}{-.5\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-.25\pgf@xa}{-.79\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-.4\pgf@xa}{-\pgf@ya}}
	\pgfpathlineto{\pgfpoint{.1\pgf@xa}{-\pgf@ya}}
	\pgfpathlineto{\pgfpoint{.25\pgf@xa}{-.79\pgf@ya}}
	\pgfpathlineto{\pgfpoint{.25\pgf@xa}{-.5\pgf@ya}}
	\pgfpathlineto{\pgfpoint{1.02\pgf@xa}{-.5\pgf@ya}}
	\pgfpathclose
}
\def\clientborder{
	\pgfmathparse{.005*\pgfshapeminwidth}\let\linewidth\pgfmathresult
	\pgfmathparse{.01*\pgfshapeminwidth}\let\linewidthlarge\pgfmathresult
	\pgfmathparse{.01*\pgfshapeminwidth}\let\cornerarc\pgfmathresult
	\pgfmathparse{.01*\pgfshapeminwidth}\let\cornerarclarge\pgfmathresult
	\pgfmathparse{.04*sqrt(\pgfshapeminwidth)}\let\fontwidth\pgfmathresult
	\pgfsetcornersarced{\pgfpoint{\cornerarc}{\cornerarc}}
	
	\pgfsetstrokecolor{black!40}
	\pgfpathmoveto{\southwest \pgf@x=.98\pgf@x \pgf@y=.50\pgf@y}
	\pgfpathlineto{\southwest \pgf@y=.48\pgf@y}
	\pgfusepath{stroke}
	
	\pgfsetstrokecolor{black!40}
	\pgfpathmoveto{\northeast \pgf@y=.73\pgf@y}
	\pgfpathlineto{\northeast \pgf@x=.98\pgf@x \pgf@y=.75\pgf@y}
	\pgfusepath{stroke}
	
	\pgfsetlinewidth{\linewidthlarge}
	% Standfuss
	\pgfdeclareverticalshading{myshadingC}{100bp}{color(0bp)=(black!10); color(50bp)=(black!50); color(100bp)=(black!10)}
	\pgfsetcornersarced{\pgfpoint{\cornerarclarge}{\cornerarclarge}}
	\pgfpathmoveto{\southwest \pgf@x=.25\pgf@x \pgf@y=0\pgf@y}
	\pgfpathlineto{\southwest \pgf@x=-.25\pgf@x \pgf@y=0\pgf@y}
	\pgfpathlineto{\southwest \pgf@x=-.25\pgf@x \pgf@y=.75\pgf@y}
	\pgfpathlineto{\southwest \pgf@x=-.10\pgf@x}
	\pgfpathlineto{\southwest \pgf@x=.40\pgf@x}
	\pgfpathlineto{\southwest \pgf@x=.25\pgf@x \pgf@y=.75\pgf@y}
	\pgfpathlineto{\southwest \pgf@x=.25\pgf@x \pgf@y=.55\pgf@y}
	\pgfclosepath	
	\pgfshadepath{myshadingC}{0}
	\pgfusepath{stroke}
	
	\pgfsetlinewidth{1pt}
	% 3D Display Rahmen
	\pgfsetcornersarced{\pgfpoint{\cornerarc}{\cornerarc}}
	\pgfsetstrokecolor{black!40}
	\pgfsetfillcolor{black!40}
	\pgfpathrectanglecorners{\southwest \pgf@x=.99\pgf@x \pgf@y=.47\pgf@y}
		{\northeast \pgf@y=.77\pgf@y}
	\pgfusepath{stroke,fill}
	
	% Schwarzer aeusserer Monitorrahmen
	\pgfsetstrokecolor{black}
	\pgfsetfillcolor{black}
	\pgfpathrectanglecorners{\southwest \pgf@y=.48\pgf@y}{\northeast \pgf@x=.98\pgf@x \pgf@y=.75\pgf@y}
	\pgfusepath{stroke,fill}
	
	% Displayflaeche
	\pgfsetfillcolor{black!90}
	\pgfpathrectanglecorners{\southwest \pgf@x=.95\pgf@x \pgf@y=.43\pgf@y}{\northeast \pgf@x=.93\pgf@x \pgf@y=.70\pgf@y}
	\pgfusepath{stroke,fill}
	
	
	\pgfdeclareradialshading{ballshading}{\pgfpoint{-10bp}{10bp}}
	 {color(0bp)=(black!40); color(6bp)=(black!60);
	  color(12bp)=(black!70); color(25bp)=(black!80); color(50bp)=(black!90)}
	\pgfpathrectanglecorners{\southwest \pgf@x=.95\pgf@x \pgf@y=.43\pgf@y}{\northeast \pgf@x=.93\pgf@x \pgf@y=.70\pgf@y}
	\pgfshadepath{ballshading}{0}
	\pgfusepath{}
}
\pgfdeclareshape{client}{
	\setpaths{\clientanchor}{\clientborder}
	\savedanchor\northeast{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=.5\pgf@x
		\pgf@y=.5\pgf@y
	}
	\savedanchor\southwest{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=-.5\pgf@x
		\pgf@y=-.5\pgf@y
	}
	\anchor{north}{\northeast \pgf@y=.75\pgf@y \pgf@x=0pt}
	\anchor{north east}{\northeast \pgf@x=.5\pgf@x \pgf@y=.625\pgf@y}
	\anchor{north west}{\northeast \pgf@x=-.5\pgf@x \pgf@y=.625\pgf@y}
	\anchor{east}{\northeast \pgf@y=0pt}
	\anchor{south}{\northeast \pgf@x=0pt \pgf@y=-.95\pgf@y}
	\anchor{south east}{\northeast \pgf@x=.5\pgf@x \pgf@y=-.55\pgf@y}
	\anchor{south west}{\northeast \pgf@x=-.5\pgf@x \pgf@y=-.55\pgf@y}
	\anchor{west}{\northeast \pgf@x=-\pgf@x \pgf@y=0pt}
	\anchor{text}{
		\pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
		\pgfmathsetlength\pgf@y{\pgfshapeminwidth}%
		\pgf@x=0pt
		\pgf@y=-.75\pgf@y
		\advance\pgf@x by -.5\wd\pgfnodeparttextbox
		\advance\pgf@y by -\ht\pgfnodeparttextbox
	}
}


%==============================================================================
% hub
%==============================================================================
\def\hubanchor{
	\pgf@xa=\pgfshapeminwidth
	\pgf@ya=\pgfshapeminwidth
	\pgf@xa=.5\pgf@xa
	\pgf@ya=.5\pgf@ya
	
	\pgfpathmoveto{\pgfpoint{0}{.95\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-\pgf@xa}{.15\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-\pgf@xa}{-.15\pgf@ya}}
	\pgfpathlineto{\pgfpoint{0}{-.95\pgf@ya}}
	\pgfpathlineto{\pgfpoint{\pgf@xa}{-.15\pgf@ya}}
	\pgfpathlineto{\pgfpoint{\pgf@xa}{.15\pgf@ya}}
	\pgfpathclose
}
\def\hubborder{
	\def\hub@strokecolor{\tikz@strokecolor}
	\def\hub@fillcolor{\tikz@fillcolor}
	\ifx\tikz@strokecolor\pgfutil@empty
		\def\hub@strokecolor{black}
	\fi
	\ifx\tikz@fillcolor\pgfutil@empty
		\def\hub@fillcolor{black}
	\fi

	\pgfmathparse{.05*\pgfshapeminwidth}\let\linewidth\pgfmathresult
	\pgfsetcornersarced{\pgfpoint{0.01pt}{0.01pt}}
	\pgfdeclareradialshading{hubTop}{\pgfpoint{0pt}{-5\pgf@ya}}{%
		rgb(0bp)=(1,1,1);
		color(70bp)=(\hub@fillcolor!80);
		rgb(105bp)=(1,1,1)}
	\pgfdeclareradialshading{hubSides}{\pgfpoint{-6\pgf@xa}{0pt}}{%
		rgb(0bp)=(1,1,1);
		color(70bp)=(\hub@fillcolor!80);
		rgb(105bp)=(1,1,1)}

	\pgfmoveto{\northeast \pgf@y=.95\pgf@y \pgf@x=0pt}
	\pgflineto{\northeast \pgf@y=.15\pgf@y}
	\pgflineto{\northeast \pgf@x=0pt \pgf@y=-.6\pgf@y}
	\pgflineto{\northeast \pgf@x=-\pgf@x \pgf@y=.15\pgf@y}
	\pgfclosepath
	\pgfshadepath{hubTop}{0}
	\pgfusepath{stroke}

	\pgfmoveto{\northeast \pgf@x=-\pgf@x \pgf@y=.15\pgf@y}
	\pgflineto{\northeast \pgf@x=-\pgf@x \pgf@y=-.15\pgf@y}
	\pgflineto{\northeast \pgf@x=0pt \pgf@y=-.95\pgf@y}
	\pgflineto{\northeast \pgf@x=0pt \pgf@y=-.6\pgf@y}
	\pgfclosepath
	\pgfshadepath{hubSides}{180}
	\pgfusepath{stroke}

	\pgfmoveto{\northeast \pgf@x=0pt \pgf@y=-.6\pgf@y}
	\pgflineto{\northeast \pgf@x=0pt \pgf@y=-.95\pgf@y}
	\pgflineto{\northeast \pgf@y=-.15\pgf@y}
	\pgflineto{\northeast \pgf@y=.15\pgf@y}
	\pgfclosepath
	\pgfshadepath{hubSides}{0}
	\pgfusepath{stroke}

	\pgftransformshift{\northeast \pgf@x=0pt \pgf@y=.15\pgf@y} 
	{
		\pgftransformxslant{1.33} 
		\pgftransformyslant{-0.375} 
		\pgfsetfillcolor{TUMRed}
		\pgftransformyscale{.9}
		\pgfmoveto{\northeast \pgf@x=-.75\pgf@x \pgf@y=.075\pgf@y}
		\pgflineto{\northeast \pgf@x=-.75\pgf@x \pgf@y=-.075\pgf@y}
		\pgflineto{\northeast \pgf@x=.15\pgf@x \pgf@y=-.075\pgf@y}
		\pgflineto{\northeast \pgf@x=.15\pgf@x \pgf@y=-.15\pgf@y}
		\pgflineto{\northeast \pgf@x=.75\pgf@x \pgf@y=0pt}
		\pgflineto{\northeast \pgf@x=.15\pgf@x \pgf@y=.15\pgf@y}
		\pgflineto{\northeast \pgf@x=.15\pgf@x \pgf@y=.15\pgf@y}
		\pgflineto{\northeast \pgf@x=.15\pgf@x \pgf@y=.075\pgf@y}
   		\pgfclosepath
		\pgfusepath{fill}
	}
}
\pgfdeclareshape{hub}{
	\setpaths{\hubanchor}{\hubborder}
	\savedanchor\northeast{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=.5\pgf@x
		\pgf@y=.5\pgf@y
	}
	\savedanchor\southwest{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=-.5\pgf@x
		\pgf@y=-.5\pgf@y
	}
	\anchor{north}{\northeast \pgf@y=.95\pgf@y \pgf@x=0pt}
	\anchor{north east}{\northeast \pgf@x=.5\pgf@x \pgf@y=.625\pgf@y}
	\anchor{north west}{\northeast \pgf@x=-.5\pgf@x \pgf@y=.625\pgf@y}
	\anchor{east}{\northeast \pgf@y=0pt}
	\anchor{south}{\northeast \pgf@x=0pt \pgf@y=-.95\pgf@y}
	\anchor{south east}{\northeast \pgf@x=.5\pgf@x \pgf@y=-.625\pgf@y}
	\anchor{south west}{\northeast \pgf@x=-.5\pgf@x \pgf@y=-.625\pgf@y}
	\anchor{west}{\northeast \pgf@x=-\pgf@x \pgf@y=0pt}
	\anchor{text}{
		\pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
		\pgfmathsetlength\pgf@y{\pgfshapeminwidth}%
		\pgf@x=0pt
		\pgf@y=-.9\pgf@y
		\advance\pgf@x by -.5\wd\pgfnodeparttextbox
		\advance\pgf@y by -\ht\pgfnodeparttextbox
	}
}


%==============================================================================
% switch
%==============================================================================
\def\switchanchor{
	\pgf@xa=\pgfshapeminwidth
	\pgf@ya=\pgfshapeminwidth
	\pgf@xa=.5\pgf@xa
	\pgf@ya=.5\pgf@ya
	
	\pgfpathmoveto{\pgfpoint{0}{.95\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-\pgf@xa}{.15\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-\pgf@xa}{-.15\pgf@ya}}
	\pgfpathlineto{\pgfpoint{0}{-.95\pgf@ya}}
	\pgfpathlineto{\pgfpoint{\pgf@xa}{-.15\pgf@ya}}
	\pgfpathlineto{\pgfpoint{\pgf@xa}{.15\pgf@ya}}
	\pgfpathclose
}
\def\switchborder{
	\def\switch@strokecolor{\tikz@strokecolor}
	\def\switch@fillcolor{\tikz@fillcolor}
	\ifx\tikz@strokecolor\pgfutil@empty
		\def\switch@strokecolor{black}
	\fi
	\ifx\tikz@fillcolor\pgfutil@empty
		\def\switch@fillcolor{black}
	\fi

	\pgfmathparse{.05*\pgfshapeminwidth}\let\linewidth\pgfmathresult
	\pgfmathparse{.1*\pgfshapeminwidth}\let\arrowdist\pgfmathresult
	\pgfsetcornersarced{\pgfpoint{0.01pt}{0.01pt}}
	\pgfdeclarehorizontalshading{switchA}{100bp}{
		color(0bp)=(\switch@fillcolor!10);
		color(100bp)=(\switch@fillcolor!50)}
	\pgfdeclareverticalshading{switchB}{100bp}{
		color(0bp)=(\switch@fillcolor!5);
		color(100bp)=(\switch@fillcolor!40)}
	\pgfdeclareradialshading{switchTop}{\pgfpoint{0pt}{-5\pgf@ya}}{%
		rgb(0bp)=(1,1,1);
		color(70bp)=(\switch@fillcolor!80);
		rgb(105bp)=(1,1,1)}
	\pgfdeclareradialshading{switchSides}{\pgfpoint{-6\pgf@xa}{0pt}}{%
		rgb(0bp)=(1,1,1);
		color(70bp)=(\switch@fillcolor!80);
		rgb(105bp)=(1,1,1)}

	\pgfmoveto{\northeast \pgf@x=0pt \pgf@y=.95\pgf@y}
	\pgflineto{\northeast \pgf@y=.15\pgf@y}
	\pgflineto{\northeast \pgf@x=0pt \pgf@y=-.6\pgf@y}
	\pgflineto{\northeast \pgf@x=-\pgf@x \pgf@y=.15\pgf@y}
	\pgfclosepath
	\pgfshadepath{switchTop}{0}
	\pgfusepath{stroke}

	\pgfmoveto{\northeast \pgf@x=-\pgf@x \pgf@y=-.15\pgf@y}
	\pgflineto{\northeast \pgf@x=-\pgf@x \pgf@y=.15\pgf@y}
	\pgflineto{\northeast \pgf@x=0pt \pgf@y=-.6\pgf@y}
	\pgflineto{\northeast \pgf@x=0pt \pgf@y=-.95\pgf@y}
	\pgfclosepath
	\pgfshadepath{switchSides}{180}
	\pgfusepath{stroke}

	\pgfmoveto{\northeast \pgf@x=0pt \pgf@y=-.6\pgf@y}
	\pgflineto{\northeast \pgf@x=0pt \pgf@y=-.95\pgf@y}
	\pgflineto{\northeast \pgf@y=-.15\pgf@y}
	\pgflineto{\northeast \pgf@y=.15\pgf@y}
	\pgfclosepath
	\pgfshadepath{switchSides}{0}
	\pgfusepath{stroke}

	\pgftransformshift{\northeast \pgf@x=0pt \pgf@y=.15\pgf@y} 
	{
		\pgftransformxslant{1.33} 
		\pgftransformyslant{-0.375} 
   		\pgfsetfillcolor{TUMRed}

		{		
			\pgftransformshift{\northeast \pgf@x=.45\pgf@x \pgf@y=.1\pgf@y} 
			\pgftransformscale{.45}
			\pgftransformyscale{.9}
			\pgfmoveto{\northeast \pgf@x=-.75\pgf@x \pgf@y=.075\pgf@y}
			\pgflineto{\northeast \pgf@x=-.75\pgf@x \pgf@y=-.075\pgf@y}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=-.075\pgf@y}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=-.15\pgf@y}
			\pgflineto{\northeast \pgf@x=.75\pgf@x \pgf@y=0pt}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=.15\pgf@y}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=.075\pgf@y}
   			\pgfclosepath
			\pgfusepath{fill}

			\pgfmoveto{\northeast \pgf@x=.75\pgf@x \pgf@y=0.20\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.20\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.125\pgf@y}
			\pgflineto{\northeast \pgf@x=-.75\pgf@x \pgf@y=0.275\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.425\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.35\pgf@y}
			\pgflineto{\northeast \pgf@x=--.75\pgf@x \pgf@y=0.35\pgf@y}
   			\pgfclosepath
			\pgfusepath{fill}
		}
		
		{		
			\pgftransformshift{\northeast \pgf@x=-.45\pgf@x \pgf@y=.1\pgf@y} 
			\pgftransformscale{.45}
			\pgftransformyscale{.9}
			\pgfmoveto{\northeast \pgf@x=-.75\pgf@x \pgf@y=.075\pgf@y}
			\pgflineto{\northeast \pgf@x=-.75\pgf@x \pgf@y=-.075\pgf@y}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=-.075\pgf@y}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=-.15\pgf@y}
			\pgflineto{\northeast \pgf@x=.75\pgf@x \pgf@y=0pt}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=.15\pgf@y}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=.075\pgf@y}
   			\pgfclosepath
			\pgfusepath{fill}

			\pgfmoveto{\northeast \pgf@x=.75\pgf@x \pgf@y=0.20\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.20\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.125\pgf@y}
			\pgflineto{\northeast \pgf@x=-.75\pgf@x \pgf@y=0.275\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.425\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.35\pgf@y}
			\pgflineto{\northeast \pgf@x=--.75\pgf@x \pgf@y=0.35\pgf@y}
   			\pgfclosepath
			\pgfusepath{fill}
		}
		
		{		
			\pgftransformshift{\northeast \pgf@x=.45\pgf@x \pgf@y=-.2\pgf@y} 
			\pgftransformscale{.45}
			\pgftransformyscale{.9}
			\pgfmoveto{\northeast \pgf@x=-.75\pgf@x \pgf@y=.075\pgf@y}
			\pgflineto{\northeast \pgf@x=-.75\pgf@x \pgf@y=-.075\pgf@y}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=-.075\pgf@y}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=-.15\pgf@y}
			\pgflineto{\northeast \pgf@x=.75\pgf@x \pgf@y=0pt}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=.15\pgf@y}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=.075\pgf@y}
   			\pgfclosepath
			\pgfusepath{fill}

			\pgfmoveto{\northeast \pgf@x=.75\pgf@x \pgf@y=0.20\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.20\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.125\pgf@y}
			\pgflineto{\northeast \pgf@x=-.75\pgf@x \pgf@y=0.275\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.425\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.35\pgf@y}
			\pgflineto{\northeast \pgf@x=--.75\pgf@x \pgf@y=0.35\pgf@y}
   			\pgfclosepath
			\pgfusepath{fill}
		}
		
		{		
			\pgftransformshift{\northeast \pgf@x=-.45\pgf@x \pgf@y=-.2\pgf@y} 
			\pgftransformscale{.45}
			\pgftransformyscale{.9}
			\pgfmoveto{\northeast \pgf@x=-.75\pgf@x \pgf@y=.075\pgf@y}
			\pgflineto{\northeast \pgf@x=-.75\pgf@x \pgf@y=-.075\pgf@y}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=-.075\pgf@y}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=-.15\pgf@y}
			\pgflineto{\northeast \pgf@x=.75\pgf@x \pgf@y=0pt}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=.15\pgf@y}
			\pgflineto{\northeast \pgf@x=.25\pgf@x \pgf@y=.075\pgf@y}
   			\pgfclosepath
			\pgfusepath{fill}

			\pgfmoveto{\northeast \pgf@x=.75\pgf@x \pgf@y=0.20\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.20\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.125\pgf@y}
			\pgflineto{\northeast \pgf@x=-.75\pgf@x \pgf@y=0.275\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.425\pgf@y}
			\pgflineto{\northeast \pgf@x=-.25\pgf@x \pgf@y=0.35\pgf@y}
			\pgflineto{\northeast \pgf@x=--.75\pgf@x \pgf@y=0.35\pgf@y}
   			\pgfclosepath
			\pgfusepath{fill}
		}
	}
}
\pgfdeclareshape{switch}{
	\setpaths{\switchanchor}{\switchborder}
	\savedanchor\northeast{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=.5\pgf@x
		\pgf@y=.5\pgf@y
	}
	\savedanchor\southwest{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=-.5\pgf@x
		\pgf@y=-.5\pgf@y
	}
	
	\anchor{north}{\northeast \pgf@y=.95\pgf@y \pgf@x=0pt}
	\anchor{north east}{\northeast \pgf@x=.5\pgf@x \pgf@y=.625\pgf@y}
	\anchor{north west}{\northeast \pgf@x=-.5\pgf@x \pgf@y=.625\pgf@y}
	\anchor{east}{\northeast \pgf@y=0pt}
	\anchor{south}{\northeast \pgf@x=0pt \pgf@y=-.95\pgf@y}
	\anchor{south east}{\northeast \pgf@x=.5\pgf@x \pgf@y=-.625\pgf@y}
	\anchor{south west}{\northeast \pgf@x=-.5\pgf@x \pgf@y=-.625\pgf@y}
	\anchor{west}{\northeast \pgf@x=-\pgf@x \pgf@y=0pt}
	\anchor{text}{
		\pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
		\pgfmathsetlength\pgf@y{\pgfshapeminwidth}%
		\pgf@x=0pt
		\pgf@y=-.9\pgf@y
		\advance\pgf@x by -.5\wd\pgfnodeparttextbox
		\advance\pgf@y by -\ht\pgfnodeparttextbox
	}
}


%==============================================================================
% router
%==============================================================================
\def\routeranchor{
	\pgf@xa=\pgfshapeminwidth
	\pgf@ya=\pgfshapeminwidth
	\pgf@xa=.5\pgf@xa
	\pgf@ya=.5\pgf@ya
	
	\pgfmathparse{1/2*\pgfshapeminwidth}\let\radiusx\pgfmathresult
	\pgfmathparse{3/8*\pgfshapeminwidth}\let\radiusy\pgfmathresult

	\pgfsetcornersarced{\pgfpoint{1pt}{1pt}}
	\pgfpathmoveto{\pgfpoint{-\pgf@xa}{-.15\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-\pgf@xa}{.15\pgf@ya}}
	\pgfpatharcaxes{180}{0}{\pgfpoint{\radiusx}{0pt}}{\pgfpoint{0pt}{\radiusy}}
	\pgfpathlineto{\pgfpoint{\pgf@xa}{-.15\pgf@ya}}
	\pgfpatharcaxes{0}{-180}{\pgfpoint{\radiusx}{0pt}}{\pgfpoint{0pt}{\radiusy}}
	\pgfpathclose
}
\def\routerborder{
	\def\router@strokecolor{\tikz@strokecolor}
	\def\router@fillcolor{\tikz@fillcolor}
	\ifx\tikz@strokecolor\pgfutil@empty
		\def\router@strokecolor{black}
	\fi
	\ifx\tikz@fillcolor\pgfutil@empty
		\def\router@fillcolor{black}
	\fi
	
	\pgfmathparse{.05*\pgfshapeminwidth}\let\linewidth\pgfmathresult
	\pgfsetcornersarced{\pgfpoint{0.01pt}{0.01pt}}
	\pgfdeclarehorizontalshading{routerA}{100bp}{%
		color(0bp)=(\router@fillcolor!50);
		color(50bp)=(\router@fillcolor!10);
		color(100bp)=(\router@fillcolor!50)
	}
	\pgfdeclareradialshading{routerTop}{\pgfpoint{0pt}{-5\pgf@ya}}{%
		rgb(0bp)=(1,1,1);
		color(70bp)=(\router@fillcolor!80);
		rgb(105bp)=(1,1,1)}

	\pgfmathparse{1/2*\pgfshapeminwidth}\let\radiusx\pgfmathresult
	\pgfmathparse{3/8*\pgfshapeminwidth}\let\radiusy\pgfmathresult

	% router body
	\pgfsetfillcolor{black!10}
	\pgfpathmoveto{\northeast \pgf@x=-\pgf@x \pgf@y=.15\pgf@y}
	\pgfpathlineto{\northeast \pgf@x=-\pgf@x \pgf@y=-.15\pgf@y}
	\pgfpatharcaxes{180}{360}{\pgfpoint{\radiusx}{0pt}}{\pgfpoint{0pt}{\radiusy}}
	\pgfpathlineto{\northeast \pgf@y=.15\pgf@y}
	\pgfclosepath
	\pgfshadepath{routerA}{0}
	\pgfusepath{stroke}
		
	\pgfpathellipse{\northeast \pgf@x=0pt \pgf@y=.15\pgf@y}
		{\northeast \pgf@y=0pt}
		{\northeast \pgf@x=0pt \pgf@y=-.75\pgf@y}
	\pgfshadepath{routerTop}{0}
	\pgfusepath{stroke}
	
	\pgftransformshift{\northeast \pgf@x=0pt \pgf@y=.15\pgf@y}{%
		{
		\pgftransformxslant{1.33} 
		\pgftransformyslant{-0.375} 
		\pgfsetfillcolor{TUMRed}
		\pgftransformyscale{.8}
		\pgftransformxscale{1.3}
		\pgfmoveto{\northeast \pgf@x=-\pgf@x \pgf@y=0pt}
		\pgflineto{\northeast \pgf@x=-.5\pgf@x \pgf@y=-.15\pgf@y}
		\pgflineto{\northeast \pgf@x=-.5\pgf@x \pgf@y=-.05\pgf@y}
		\pgflineto{\northeast \pgf@x=.5\pgf@x \pgf@y=-.05\pgf@y}
		\pgflineto{\northeast \pgf@x=.5\pgf@x \pgf@y=-.15\pgf@y}
		\pgflineto{\northeast \pgf@x=\pgf@x \pgf@y=0pt}
		\pgflineto{\northeast \pgf@x=.5\pgf@x \pgf@y=.15\pgf@y}
		\pgflineto{\northeast \pgf@x=.5\pgf@x \pgf@y=.05\pgf@y}
		\pgflineto{\northeast \pgf@x=-.5\pgf@x \pgf@y=.05\pgf@y}
		\pgflineto{\northeast \pgf@x=-.5\pgf@x \pgf@y=.15\pgf@y}
   		\pgfclosepath
		\pgfusepath{fill}
		}

		{
		\pgftransformxslant{1.33} 
		\pgftransformyslant{-0.375} 
		\pgfsetfillcolor{TUMRed}
		\pgftransformyscale{0.5}
		\pgftransformxscale{2.2}
		\pgfmoveto{\northeast \pgf@y=-\pgf@y \pgf@x=0pt}
		\pgflineto{\northeast \pgf@y=-.5\pgf@y \pgf@x=-.15\pgf@x}
		\pgflineto{\northeast \pgf@y=-.5\pgf@y \pgf@x=-.05\pgf@x}
		\pgflineto{\northeast \pgf@y=.5\pgf@y \pgf@x=-.05\pgf@x}
		\pgflineto{\northeast \pgf@y=.5\pgf@y \pgf@x=-.15\pgf@x}
		\pgflineto{\northeast \pgf@y=\pgf@y \pgf@x=0pt}
		\pgflineto{\northeast \pgf@y=.5\pgf@y \pgf@x=.15\pgf@x}
		\pgflineto{\northeast \pgf@y=.5\pgf@y \pgf@x=.05\pgf@x}
		\pgflineto{\northeast \pgf@y=-.5\pgf@y \pgf@x=.05\pgf@x}
		\pgflineto{\northeast \pgf@y=-.5\pgf@y \pgf@x=.15\pgf@x}
   		\pgfclosepath
		\pgfusepath{fill}
		}
	}
}
\pgfdeclareshape{router}{
	\setpaths{\routeranchor}{\routerborder}
	\savedanchor\northeast{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=.5\pgf@x
		\pgf@y=.5\pgf@y
	}
	\savedanchor\southwest{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=-.5\pgf@x
		\pgf@y=-.5\pgf@y
	}
	\anchor{north}{\northeast \pgf@y=.95\pgf@y \pgf@x=0pt}
	\anchor{east}{\northeast \pgf@y=0pt}
	\anchor{south}{\northeast \pgf@x=0pt \pgf@y=-.95\pgf@y}
	\anchor{west}{\northeast \pgf@x=-\pgf@x \pgf@y=0pt}
	\anchor{north east}{\northeast \pgf@y=.7\pgf@y \pgf@x=.7\pgf@x}
	\anchor{north west}{\northeast \pgf@y=.7\pgf@y \pgf@x=-.7\pgf@x}
	\anchor{south west}{\northeast \pgf@y=-.7\pgf@y \pgf@x=-.7\pgf@x}
	\anchor{south east}{\northeast \pgf@y=-.7\pgf@y \pgf@x=.7\pgf@x}
	\anchor{text}{
		\pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
		\pgfmathsetlength\pgf@y{\pgfshapeminwidth}%
		\pgf@x=0pt
		\pgf@y=-.9\pgf@y
		\advance\pgf@x by -.5\wd\pgfnodeparttextbox
		\advance\pgf@y by -\ht\pgfnodeparttextbox
	}
}


%==============================================================================
% nuc
%==============================================================================
\def\nucanchor{
	\pgf@xa=\pgfshapeminwidth
	\pgf@ya=\pgfshapeminwidth
	\pgf@xa=.5\pgf@xa
	\pgf@ya=.5\pgf@ya

	\pgfsetcornersarced{\pgfpoint{1pt}{1pt}}
	\pgfpathmoveto{\pgfpoint{0}{\pgf@ya}}
	\pgfpathlineto{\pgfpoint{\pgf@xa}{.25\pgf@ya}}
	\pgfpathlineto{\pgfpoint{\pgf@xa}{-.25\pgf@ya}}
	\pgfpathlineto{\pgfpoint{0}{-\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-\pgf@xa}{-.25\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-\pgf@xa}{.25\pgf@ya}}
	\pgfpathclose
}
\def\nucborder{
	%\pgfdeclarehorizontalshading{front}{100bp}{
	%	color(0bp)=(black!40);
	%	color(100bp)=(black!50)
	%}
	\pgfdeclareradialshading{front}{\pgfpoint{.7cm}{-.5cm}}{
		color(0bp)=(black!20);
		color(6bp)=(black!30);
		color(12bp)=(black!35);
		color(25bp)=(black!40);
		color(50bp)=(black!45)
	}
	\pgfdeclareradialshading{top}{\pgfpoint{-10bp}{10bp}}{
		color(0bp)=(black!40);
		color(6bp)=(black!60);
		color(12bp)=(black!80);
		color(25bp)=(black!90);
		color(50bp)=(black!100)
	}
	
	% rear antenna
	\pgfmathparse{.075*\pgfshapeminwidth}
	\pgfsetlinewidth\pgfmathresult
	\pgfsys@roundcap

	\pgfmoveto{\northeast \pgf@x=-.1\pgf@x \pgf@y=.6\pgf@y}
	\pgflineto{\northeast \pgf@x=-.2\pgf@x \pgf@y=.7\pgf@y}
	\pgflineto{\northeast \pgf@x=-.4\pgf@x \pgf@y=1.5\pgf@y}
	\pgfusepath{stroke}

	% body
	\pgfmathparse{.025*\pgfshapeminwidth}
	\pgfsetlinewidth\pgfmathresult
	\pgfsetcornersarced{\pgfpoint{1pt}{1pt}}

	\pgfmoveto{\northeast \pgf@x=0pt}
	\pgflineto{\northeast \pgf@y=.25\pgf@y}
	\pgflineto{\northeast \pgf@x=0pt \pgf@y=-.5\pgf@y}
	\pgflineto{\northeast \pgf@x=-\pgf@x \pgf@y=.25\pgf@y}
	\pgfclosepath
	\pgfshadepath{top}{0}
	\pgfusepath{stroke}

	\pgfmoveto{\northeast \pgf@x=-\pgf@x \pgf@y=-.25\pgf@y}
	\pgflineto{\northeast \pgf@x=-\pgf@x \pgf@y=.25\pgf@y}
	\pgflineto{\northeast \pgf@x=0pt \pgf@y=-.5\pgf@y}
	\pgflineto{\northeast \pgf@x=0pt \pgf@y=-\pgf@y}
	\pgfclosepath
	\pgfshadepath{front}{180}
	\pgfusepath{stroke}

	\pgfmoveto{\northeast \pgf@x=0pt \pgf@y=-.5\pgf@y}
	\pgflineto{\northeast \pgf@x=0pt \pgf@y=-\pgf@y}
	\pgflineto{\northeast \pgf@y=-.25\pgf@y}
	\pgflineto{\northeast \pgf@y=.25\pgf@y}
	\pgfclosepath
	\pgfshadepath{front}{0}
	\pgfusepath{stroke}

	% front antennas
	\pgfmathparse{.075*\pgfshapeminwidth}
	\pgfsetlinewidth\pgfmathresult
	\pgfsys@roundcap

	\pgfmoveto{\northeast \pgf@x=-.5\pgf@x \pgf@y=-.4\pgf@y}
	\pgflineto{\northeast \pgf@x=-.6\pgf@x \pgf@y=-.5\pgf@y}
	\pgflineto{\northeast \pgf@x=-.8\pgf@x \pgf@y=.7\pgf@y}
	\pgfusepath{stroke}

	\pgfmoveto{\northeast \pgf@x=.5\pgf@x \pgf@y=-.4\pgf@y}
	\pgflineto{\northeast \pgf@x=.6\pgf@x \pgf@y=-.5\pgf@y}
	\pgflineto{\northeast \pgf@x=.8\pgf@x \pgf@y=.7\pgf@y}
	\pgfusepath{stroke}

	\pgftransformshift{\northeast \pgf@x=0pt \pgf@y=.25\pgf@y}{
		\pgfsetfillcolor{cyan}
		\pgfpathcircle{
			\northeast \pgf@x=.05\pgf@x\pgf@y=.45\pgf@y
		}{
			.15\pgflinewidth
		}
		\pgfusepath{fill}
	}
}
\pgfdeclareshape{nuc}{
	\setpaths{\nucanchor}{\nucborder}
	\savedanchor\northeast{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=.5\pgf@x
		\pgf@y=.5\pgf@y
	}
	\savedanchor\southwest{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=-.5\pgf@x
		\pgf@y=-.5\pgf@y
	}
	\anchor{north}{\northeast \pgf@y=.95\pgf@y \pgf@x=0pt}
	\anchor{north east}{\northeast \pgf@x=.58\pgf@x \pgf@y=.58\pgf@y}
	\anchor{east}{\northeast \pgf@y=0pt}
	\anchor{south east}{\northeast \pgf@x=.58\pgf@x \pgf@y=-.58\pgf@y}
	\anchor{south}{\northeast \pgf@x=0pt \pgf@y=-.95\pgf@y}
	\anchor{south west}{\northeast \pgf@x=-.58\pgf@x \pgf@y=-.58\pgf@y}
	\anchor{west}{\northeast \pgf@x=-\pgf@x \pgf@y=0pt}
	\anchor{north west}{\northeast \pgf@x=-.58\pgf@x \pgf@y=.58\pgf@y}
	\anchor{text}{
		\pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
		\pgfmathsetlength\pgf@y{\pgfshapeminwidth}%
		\pgf@x=0pt
		\pgf@y=-.75\pgf@y
		\advance\pgf@x by -.5\wd\pgfnodeparttextbox
		\advance\pgf@y by -\ht\pgfnodeparttextbox
	}
}


%==============================================================================
% messageopen
%==============================================================================
\def\messageopenanchor{
	\pgf@xa=\pgfshapeminwidth
	\pgf@ya=\pgfshapeminwidth
	\pgf@xa=.5\pgf@xa
	\pgf@ya=.5\pgf@ya

	\pgfsetcornersarced{\pgfpoint{0.01pt}{0.01pt}}
	\pgfpathmoveto{\pgfpoint{0}{\pgf@ya}}
	\pgfpathlineto{\pgfpoint{.27\pgf@xa}{.8\pgf@ya}}
	\pgfpathlineto{\pgfpoint{.8\pgf@xa}{.8\pgf@ya}}
	\pgfpathlineto{\pgfpoint{.8\pgf@xa}{.44\pgf@ya}}
	\pgfpathlineto{\pgfpoint{\pgf@xa}{.25\pgf@ya}}
	\pgfpathlineto{\pgfpoint{\pgf@xa}{-\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-\pgf@xa}{-\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-\pgf@xa}{.25\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-.8\pgf@xa}{.44\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-.8\pgf@xa}{.8\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-.27\pgf@xa}{.8\pgf@ya}}
	\pgfpathclose
}
\def\messageopenborder{
	\pgfmathparse{.2*sqrt(\pgfshapeminwidth)}\let\cornerarc\pgfmathresult
	\pgfsetcornersarced{\pgfpoint{\cornerarc}{\cornerarc}}
	
	\ifx\tikz@strokecolor\pgfutil@empty
		\pgfsys@color@rgb@stroke{0.84}{0.58}{0.47}
	\else
		\pgfsetfillcolor{\tikz@strokecolor}
	\fi
	\ifx\tikz@fillcolor\pgfutil@empty
		\pgfsys@color@rgb@fill{0.82}{0.65}{0.36}
	\else
		\pgfsetfillcolor{\tikz@fillcolor}
	\fi

	\pgfpathmoveto{\northeast \pgf@x=0\pgf@x}
	\pgfpathlineto{\northeast \pgf@y=.25\pgf@y \pgf@x=-\pgf@x}
	\pgfpathlineto{\southwest}
	\pgfpathlineto{\southwest \pgf@x=-\pgf@x}
	\pgfpathlineto{\southwest \pgf@x=-\pgf@x \pgf@y=-.25\pgf@y}
	\pgfclosepath
	\pgfusepath{fill}

	% Aeusserer Rand um das gesamte Couvert	
	\pgfpathmoveto{\northeast \pgf@x=0\pgf@x}
	\pgfpathlineto{\northeast \pgf@y=.25\pgf@y}
	\pgfpathlineto{\northeast \pgf@y=-\pgf@y}
	\pgfpathlineto{\northeast \pgf@x=-\pgf@x \pgf@y=-\pgf@y}
	\pgfpathlineto{\northeast \pgf@x=-\pgf@x \pgf@y=.25\pgf@y}
	\pgfclosepath
	\pgfusepath{stroke}	

	% Papier
	\pgfsetstrokecolor{TUMBlue!50}
	\pgfdeclarehorizontalshading{myshadingE}{100bp}{color(0bp)=(white); color(100bp)=(TUMBlue!30)}
	\pgfsetcornersarced{\pgfpoint{0.01pt}{0.01pt}}
	\pgfpathrectanglecorners{\northeast \pgf@x=.8\pgf@x \pgf@y=.8\pgf@y}
		{\northeast \pgf@x=-.8\pgf@x \pgf@y=-.8\pgf@y}
	\pgfshadepath{myshadingE}{0}
	\pgfusepath{stroke}		
	
	% Linke Seite des Couverts (ohne Rand)
	\pgfsetcornersarced{\pgfpoint{\cornerarc}{\cornerarc}}
	\ifx\tikz@fillcolor\pgfutil@empty
		\pgfsys@color@rgb@fill{0.91}{0.82}{0.67}
	\else
		\pgfsetfillcolor{\tikz@fillcolor}
	\fi
	\ifx\tikz@strokecolor\pgfutil@empty
		\pgfsys@color@rgb@stroke{0.84}{0.58}{0.47}
	\else
		\pgfsetstrokecolor{\tikz@strokecolor}
	\fi
	\pgfpathmoveto{\southwest}
	\pgfpathlineto{\southwest \pgf@y=-.25\pgf@y}
	\pgfpathlineto{\southwest \pgf@y=.3875\pgf@y \pgf@x=0\pgf@x}
	\pgfclosepath
	\pgfusepath{stroke,fill}

	% Rechte Seite des Couverts (ohne Rand)
	\pgfpathmoveto{\southwest \pgf@x=-\pgf@x}
	\pgfpathlineto{\southwest \pgf@y=-.25\pgf@y \pgf@x=-\pgf@x}
	\pgfpathlineto{\southwest \pgf@y=.3875\pgf@y \pgf@x=0\pgf@x}
	\pgfclosepath
	\pgfusepath{stroke,fill}
	
	% Untere Seite des Couverts (ohne Rand)
	\pgfpathmoveto{\southwest}
	\pgfpathlineto{\southwest \pgf@x=-\pgf@x}
	\pgfpathlineto{\southwest \pgf@y=.3\pgf@y \pgf@x=0\pgf@x}
	\pgfclosepath
	\pgfusepath{stroke,fill}
}
\pgfdeclareshape{messageopen}{
	\setpaths{\messageopenanchor}{\messageopenborder}
	\savedanchor\northeast{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=.5\pgf@x
		\pgf@y=.5\pgf@y
	}
	\savedanchor\southwest{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=-.5\pgf@x
		\pgf@y=-.5\pgf@y
	}
	\anchor{north}{\northeast \pgf@x=0pt}
	\anchor{north east}{\northeast \pgf@x=.8\pgf@x \pgf@y=.8\pgf@y}
	\anchor{east}{\northeast \pgf@y=0pt}
	\anchor{south east}{\northeast \pgf@y=-\pgf@y}
	\anchor{south}{\northeast \pgf@x=0pt \pgf@y=-\pgf@y}
	\anchor{south west}{\northeast \pgf@x=-\pgf@x \pgf@y=-\pgf@y}
	\anchor{west}{\northeast \pgf@x=-\pgf@x \pgf@y=0pt}
	\anchor{north west}{\northeast \pgf@x=-.8\pgf@x \pgf@y=.8\pgf@y}
	\anchor{text}{
		\pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
		\pgfmathsetlength\pgf@y{\pgfshapeminwidth}%
		\pgf@x=0pt
		\pgf@y=-.75\pgf@y
		\advance\pgf@x by -.5\wd\pgfnodeparttextbox
		\advance\pgf@y by -\ht\pgfnodeparttextbox
	}
}

%==============================================================================
% messageclosed
%==============================================================================
\def\messageclosedanchor{
	\pgf@xa=\pgfshapeminwidth
	\pgf@ya=\pgfshapeminwidth
	\pgf@xa=.5\pgf@xa
	\pgf@ya=.5\pgf@ya
	\pgfpathmoveto{\pgfpoint{\pgf@xa}{.625\pgf@ya}}
	\pgfpathlineto{\pgfpoint{\pgf@xa}{-.625\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-\pgf@xa}{-.625\pgf@ya}}
	\pgfpathlineto{\pgfpoint{-\pgf@xa}{.625\pgf@ya}}
	\pgfpathclose
}
\def\messageclosedborder{
	\ifx\tikz@strokecolor\pgfutil@empty
		\pgfsys@color@rgb@stroke{0.84}{0.58}{0.47}
	\else
		\pgfsetstrokecolor{\tikz@strokecolor}
	\fi
	\ifx\tikz@fillcolor\pgfutil@empty
		\pgfsys@color@rgb@fill{0.91}{0.82}{0.67}
	\else
		\pgfsetfillcolor{\tikz@fillcolor}
	\fi

	\pgfmathparse{.05*sqrt(\pgfshapeminwidth)}\let\linewidth\pgfmathresult
	\pgfmathparse{.1*\pgfshapeminwidth}\let\fontwidth\pgfmathresult
	\pgfmathparse{.2*sqrt(\pgfshapeminwidth)}\let\cornerarc\pgfmathresult

	\pgfsetlinewidth{\linewidth}
	\pgfsetcornersarced{\pgfpoint{\cornerarc}{\cornerarc}}
	
	% Linke Seite des Couverts (ohne Rand)
	\pgfsetcornersarced{\pgfpoint{\cornerarc}{\cornerarc}}
	\pgfpathmoveto{\southwest \pgf@y=.625\pgf@y}
	\pgfpathlineto{\southwest \pgf@y=-.625\pgf@y}
	\pgfpathlineto{\southwest \pgf@y=.0125\pgf@y \pgf@x=0\pgf@x}
	\pgfclosepath
	\pgfusepath{stroke,fill}

	% Rechte Seite des Couverts (ohne Rand)
	\pgfpathmoveto{\southwest \pgf@x=-\pgf@x \pgf@y=.625\pgf@y}
	\pgfpathlineto{\southwest \pgf@y=-.625\pgf@y \pgf@x=-\pgf@x}
	\pgfpathlineto{\southwest \pgf@y=.0125\pgf@y \pgf@x=0\pgf@x}
	\pgfclosepath
	\pgfusepath{stroke,fill}
	
	% Untere Seite des Couverts (ohne Rand)
	\pgfpathmoveto{\southwest \pgf@y=.625\pgf@y}
	\pgfpathlineto{\southwest \pgf@x=-\pgf@x \pgf@y=.625\pgf@y}
	\pgfpathlineto{\southwest \pgf@y=-.075\pgf@y \pgf@x=0\pgf@x}
	\pgfclosepath
	\pgfusepath{stroke,fill}
   
	% Obere Seite des Couverts (ohne Rand)
	\pgfpathmoveto{\southwest \pgf@y=-.625\pgf@y}
	\pgfpathlineto{\southwest \pgf@x=-\pgf@x \pgf@y=-.625\pgf@y}
	\pgfpathlineto{\southwest \pgf@y=.075\pgf@y \pgf@x=0\pgf@x}
	\pgfclosepath
	\pgfusepath{stroke,fill}
}
\pgfdeclareshape{messageclosed}{
	\setpaths{\messageclosedanchor}{\messageclosedborder}
	\savedanchor\northeast{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=.5\pgf@x
		\pgf@y=.5\pgf@y
	}
	\savedanchor\southwest{%
		\pgf@x = \pgfshapeminwidth
		\pgf@y = \pgfshapeminwidth
		\pgf@x=-.5\pgf@x
		\pgf@y=-.5\pgf@y
	}
	\anchor{north}{\northeast \pgf@x=0pt \pgf@y=.625\pgf@y}
	\anchor{north east}{\northeast \pgf@y=.625\pgf@y}
	\anchor{east}{\northeast \pgf@y=0pt}
	\anchor{south east}{\northeast \pgf@y=-.625\pgf@y}
	\anchor{south}{\northeast \pgf@x=0pt \pgf@y=-.625\pgf@y}
	\anchor{south west}{\northeast \pgf@x=-\pgf@x \pgf@y=-.625\pgf@y}
	\anchor{west}{\northeast \pgf@x=-\pgf@x \pgf@y=0pt}
	\anchor{north west}{\northeast \pgf@x=-\pgf@x \pgf@y=.625\pgf@y}
	\anchor{text}{
		\pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
		\pgfmathsetlength\pgf@y{\pgfshapeminwidth}%
		\pgf@x=0pt
		\pgf@y=-.5\pgf@y
		\advance\pgf@x by -.5\wd\pgfnodeparttextbox
		\advance\pgf@y by -\ht\pgfnodeparttextbox
	}
}


% Redfined checkerboard decoration with better image quality than the default
\pgfdeclarepatternformonly[\CheckerSize]{moepcheckerboard}% name
{\pgfqpoint{0mm}{0mm}}% origin
{\pgfqpoint{2\CheckerSize}{2\CheckerSize}}% top right
{\pgfqpoint{\CheckerSize}{\CheckerSize}}% tile size
{% code
	\pgfsetfillcolor{black!15}
	\pgfpathrectanglecorners{\pgfqpoint{0mm}{0mm}}{\pgfqpoint{2.5mm}{2.5mm}}
	\pgfusepath{fill}
	\pgfpathrectanglecorners{\pgfqpoint{2.5mm}{2.5mm}}{\pgfqpoint{5mm}{5mm}}
	\pgfusepath{fill}
	\pgfsetfillcolor{black!25}
	\pgfpathrectanglecorners{\pgfqpoint{0mm}{2.5mm}}{\pgfqpoint{2.5mm}{5mm}}
	\pgfusepath{fill}
	\pgfpathrectanglecorners{\pgfqpoint{2.5mm}{0mm}}{\pgfqpoint{5mm}{2.5mm}}
	\pgfusepath{fill}
}
%
\newdimen\CheckerSize
\tikzset{
    CheckerSize/.code={\CheckerSize=#1},
    CheckerSize=5mm
}

% Redefined line decoration that allows for custom spacing
%FIXME add a color option
\pgfdeclarepatternformonly[\LineSpacing]{moepNorthWestLines}{
	\pgfqpoint{0pt}{0pt}}{\pgfqpoint{-10mm}{10mm}
}{
	\pgfqpoint{\LineSpacing}{\LineSpacing}
}
{
  \pgfsetlinewidth{0.3pt}
  \pgfsetstrokecolor{black!40}
  \pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
  \pgfpathlineto{\pgfqpoint{-10mm}{10mm}}
  \pgfusepath{stroke}
}
\pgfdeclarepatternformonly[\LineSpacing]{moepSouthEastLines}{
	\pgfqpoint{0pt}{0pt}}{\pgfqpoint{10mm}{10mm}
}{
	\pgfqpoint{\LineSpacing}{\LineSpacing}
}
{
  \pgfsetlinewidth{0.3pt}
  \pgfsetstrokecolor{black!40}
  \pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
  \pgfpathlineto{\pgfqpoint{10mm}{10mm}}
  \pgfusepath{stroke}
}
%
\newdimen\LineSpacing
\tikzset{
    LineSpacing/.code={\LineSpacing=#1},
    LineSpacing=3pt
}


\makeatother

\endinput
